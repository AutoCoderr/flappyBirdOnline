<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Flappybird online</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<h1>Flappybird online</h1>
	<div id="display_party">
		PV : <span id="life">0</span>
		Tuyaux pass√©s : <span id="pipes_passed">0</span>
		<img id="level" width="1200" height="600">
	</div>
	<div id="login">
		<h2>Veuillez choisir votre pseudo :</h2>
		<input type="text" id="pseudo_input"/><br/>
		<span id="error_login"></span>
		<input type="button" id="login_button" value="Valider">
	</div>
	<div id="choose_party_type">
		<input type="button" value="Lancer partie solo" id="single_party_button"/>
	</div>
	<div id="msgs"></div>
</body>
</html>
<script src="socket.io.js"></script>
<script>
	const socket = io.connect('http://' + location.hostname + ':' + location.port);

	socket.on("updateLevel", function (url) {
		document.getElementById("level").src = url;
	});

	socket.on("start_party", function () {
		hide("choose_party_type");
		display("display_party")
	});

	socket.on("login_successfull", function () {
		hide("login");
		display("choose_party_type");
	});

	socket.on("display_msgs", function (data) {
		if (typeof(data.msgs) == "string") {
			document.getElementById("msgs").innerHTML = "<span style='color: "+(data.type === "error" ? "red" : "green")+"'>"+data.msgs+"</span>";
		} else if (typeof(data.msgs) == "object" && data.msgs instanceof Array) {
			let str = "<ul>";
			for (let i = 0; i < data.msgs.length; i++) {
				str += "<li style='color: "+(data.type === "error" ? "red" : "green")+"'>" + data.msgs[i] + "</li>";
			}
			str += "</ul>";
			document.getElementById("msgs").innerHTML = str;
		}
	});

	socket.on("remove_msgs", function () {
		document.getElementById("msgs").innerHTML = "";
	});

	socket.on("display_pipes_passed", function (nb) {
		document.getElementById("pipes_passed").innerText = nb;
	});

	socket.on("display_life", function (pv) {
		document.getElementById("life").innerText = pv;
	});

	onclick("login_button", function () {
		if (document.getElementById("pseudo_input").value === "") {
			document.getElementById("error_login").innerText = "Vous n'avez rien rentrez";
			return;
		}
		socket.emit("login", document.getElementById("pseudo_input").value);
	});

	onclick("single_party_button", function () {
		socket.emit("single_party");
	});

	document.onkeydown = function (){
		switch (event.keyCode) {
			case 32: // espace
				socket.emit("fly_bird");
		}
	};

	document.onkeyup = function (){
		switch (event.keyCode) {
			case 32: // espace
				socket.emit("release_bird");
		}
	};

	function display(id) {
		document.getElementById(id).style.display = "block";
	}

	function hide(id) {
		document.getElementById(id).style.display = "none";
	}

	function onclick(id, callback) {
		document.getElementById(id).onclick = callback;
	}
</script>
